<!--
    
CREATE DATABASE ESC_PROJECT
USE ESC_PROJECT
SET DATEFORMAT DMY

-------------------------------------------------------------------------------- SEQUENCES

CREATE SEQUENCE SEQ_PARENTESCO
AS INTEGER 
START WITH 1
INCREMENT BY 1
MINVALUE 1
MAXVALUE 99
CYCLE;

CREATE SEQUENCE SEQ_ROLES
AS INTEGER 
START WITH 1
INCREMENT BY 1
MINVALUE 1
MAXVALUE 20
CYCLE;

-------------------------------------------------------------------------------- TABLES

CREATE TABLE TB_Notas(
	ID_MATERIA int NOT NULL IDENTITY,
	NOMBRE VARCHAR(50),
	CONSTRAINT PK_ID_NOTAS
	PRIMARY KEY(ID_NOTAS)
);


CREATE TABLE TB_Roles(
	ID_ROL NUMERIC(1) NOT NULL,
	NOMBRE VARCHAR(25) NOT NULL 

	CONSTRAINT PK_ID_ROL
	PRIMARY KEY (ID_ROL)
);

CREATE TABLE TB_Usuarios(
	USUARIO VARCHAR(50) NOT NULL,
	PASS VARCHAR(50) NOT NULL,
	INTENTOS_FALLIDOS NUMERIC(1),
	CUENTA_BLOQUEADA BIT,
	CUENTA_DESACTIVADA BIT,
	CODIGO VARCHAR(50),
	NOMBRE VARCHAR(50) NOT NULL,
	APELLIDOS VARCHAR(50) NOT NULL,
	ID_ROL NUMERIC(1) NOT NULL,
	TELEFONO VARCHAR(50) NOT NULL,
	EMAIL VARCHAR(50) NOT NULL,
	CEDULA varchar(50) NOT NULL,
	FOTO VARCHAR(200),		
	FRASE VARCHAR(300)
	
	CONSTRAINT PK_USUARIO
	PRIMARY KEY (USUARIO),

	CONSTRAINT FK_ID_ROL
	FOREIGN KEY (ID_ROL)
	REFERENCES TB_ROLES(ID_ROL)
);

CREATE TABLE TB_Parentesco(
	ID_PARENTESCO VARCHAR(25) NOT NULL,
	NOMBRE VARCHAR(25) NOT NULL

	CONSTRAINT PK_ID_PARENTESCO
	PRIMARY KEY(ID_PARENTESCO)
);

CREATE TABLE TB_Encargados(
	ID_ENCARGADO VARCHAR(50) NOT NULL,
	NOMBRE VARCHAR(50) NOT NULL,
	APELLIDOS VARCHAR(50) NOT NULL,
	TEL_RESIDENCIA VARCHAR(50),
	TEL_TRABAJO VARCHAR(50),
	TEL_MOVIL VARCHAR(50) NOT NULL,
	ID_PARENTESCO VARCHAR(25) NOT NULL,
	LUGAR_TRABAJO VARCHAR(50),
	OCUPACION VARCHAR(50)

	CONSTRAINT PK_ID_ENCARGADO
	PRIMARY KEY (ID_ENCARGADO),

    CONSTRAINT FK_ID_PARENTESCO
	FOREIGN KEY (ID_PARENTESCO)
	REFERENCES TB_PARENTESCO(ID_PARENTESCO)
);

CREATE TABLE TB_Niveles(
	ID_NIVEL VARCHAR(50) NOT NULL,
	NOMBRE VARCHAR(50) NOT NULL

	CONSTRAINT PK_ID_NIVEL
	PRIMARY KEY(ID_NIVEL)
);

CREATE TABLE TB_Notas(
	ID_NOTAS int NOT NULL IDENTITY,
	ID_ESTUDIANTE VARCHAR(50) NOT NULL,
	ID_MATERIA VARCHAR(50) NOT NULL,
	PRIMER_PERIODO VARCHAR(10),
	SEGUNDO_PERIODO VARCHAR(10),
	TERCER_PERIODO VARCHAR(10),
	CONVOCATORIA_I VARCHAR(10),
	CONVOCATORIA_II VARCHAR(10),
	CONVOCATORIA_III VARCHAR(10),
	PROMEDIO VARCHAR(10)

	CONSTRAINT PK_ID_NOTAS
	PRIMARY KEY(ID_NOTAS)
);

CREATE TABLE TB_Estudiantes(
	ID_ESTUDIANTE VARCHAR(50) NOT NULL,
	ID_ENCARGADO VARCHAR(50) NOT NULL,
	NOMBRE VARCHAR(50) NOT NULL,
	APELLIDOS VARCHAR(50) NOT NULL,
	TELEFONO VARCHAR(50) NOT NULL,
	EMAIL VARCHAR(50),
	PADECIMIENTOS VARCHAR(50) NOT NULL,
	DIRECCION VARCHAR(50) NOT NULL,
	GRADUADO BIT NOT NULL,
	ABANDONO BIT NOT NULL,
	ANO_GRADUACION VARCHAR(50),
	ID_NIVEL VARCHAR(50) NOT NULL,
	SECCION VARCHAR(50) NOT NULL,
	ADELANTA BIT NOT NULL,
	NIVEL_ADELANTA VARCHAR(50),
	
	CONSTRAINT PK_ID_ESTUDIANTE
	PRIMARY KEY (ID_ESTUDIANTE),

    CONSTRAINT FK_ID_NIVEL
	FOREIGN KEY (ID_NIVEL)
	REFERENCES TB_Niveles(ID_NIVEL),

	CONSTRAINT FK_ID_ENCARGADO
	FOREIGN KEY (ID_ENCARGADO)
	REFERENCES TB_Encargados(ID_ENCARGADO)
);

CREATE TABLE TB_Profesores(
	ID_PROFESOR VARCHAR(50) NOT NULL,
	NOMBRE VARCHAR(50) NOT NULL,
	APELLIDOS VARCHAR(50) NOT NULL,
	TELEFONO VARCHAR(50) NOT NULL,
	EMAIL VARCHAR(50),
	PADECIMIENTOS VARCHAR(50) NOT NULL,
	DIRECCION VARCHAR(50) NOT NULL,
	
	CONSTRAINT PK_ID_PROFESOR
	PRIMARY KEY (ID_PROFESOR)
);


-------------------------------------------------------------------------------- INSERTS

INSERT INTO TB_Roles VALUES (NEXT VALUE FOR SEQ_ROLES, 'ADMINISTRADOR')
INSERT INTO TB_Roles VALUES (NEXT VALUE FOR SEQ_ROLES, 'USUARIO')

INSERT INTO TB_Usuarios VALUES ('32PvPP54oP0=','32PvPP54oP0=',0,0,0,'dd+J41PNOSI=','oqf2HXmP4Fw=','TkQSQue7ECMFucEAY1BKyA==',1,'891P8SeRt70SnulJIk6Czg==','MO9MLCPED929cYnEHyohM3x9pU/kY3gQ','9XpZH3+LcJ5OznzDW80M8A==','ZLKkeo2aiP28A9EaK6uVRK8wDGBnmfOW8UrNv2yB8pWR/EkP72TzO41McTNcZrTlI4rU7N/ah6H33gpib6napw==','iLA/rlRhiibr6RVsJUvpskMfZtF5H1F8QfwW8Farmg0=')

INSERT INTO TB_Niveles VALUES ('1', 'Séptimo')
INSERT INTO TB_Niveles VALUES ('2', 'Octavo')
INSERT INTO TB_Niveles VALUES ('3', 'Noveno')
INSERT INTO TB_Niveles VALUES ('4', 'Décimo')
INSERT INTO TB_Niveles VALUES ('5', 'Undécimo')

INSERT INTO TB_Parentesco VALUES (NEXT VALUE FOR SEQ_PARENTESCO, 'MAMÁ')
INSERT INTO TB_Parentesco VALUES (NEXT VALUE FOR SEQ_PARENTESCO, 'PAPÁ')
INSERT INTO TB_Parentesco VALUES (NEXT VALUE FOR SEQ_PARENTESCO, 'HERMANO')
INSERT INTO TB_Parentesco VALUES (NEXT VALUE FOR SEQ_PARENTESCO, 'HERMANA')
INSERT INTO TB_Parentesco VALUES (NEXT VALUE FOR SEQ_PARENTESCO, 'TÍO')
INSERT INTO TB_Parentesco VALUES (NEXT VALUE FOR SEQ_PARENTESCO, 'TÍA')
INSERT INTO TB_Parentesco VALUES (NEXT VALUE FOR SEQ_PARENTESCO, 'ABUELO')
INSERT INTO TB_Parentesco VALUES (NEXT VALUE FOR SEQ_PARENTESCO, 'ABUELA')
INSERT INTO TB_Parentesco VALUES (NEXT VALUE FOR SEQ_PARENTESCO, 'PADRINO')
INSERT INTO TB_Parentesco VALUES (NEXT VALUE FOR SEQ_PARENTESCO, 'MADRINA')
INSERT INTO TB_Parentesco VALUES (NEXT VALUE FOR SEQ_PARENTESCO, 'MADRASTRA')
INSERT INTO TB_Parentesco VALUES (NEXT VALUE FOR SEQ_PARENTESCO, 'PADRASTRO')

-------------------------------------------------------------------------------- STORED PROCEDURES

select*from TB_Encargados
    
-------------------------------------------------------------------------------- TOOLS

-- RESTART SEQUENCE

ALTER SEQUENCE SEQ_PARENTESCO RESTART

-- DELETE DATA FROM TABLE

DELETE TB_Roles
DELETE TB_Usuarios
DELETE TB_Parentesco
DELETE TB_Encargados

-- DROP TABLE

DROP TABLE TB_Roles
DROP TABLE TB_Usuarios
DROP TABLE TB_Parentesco
DROP TABLE TB_Encargados











CREATE TABLE TB_Profesores(
	ID_PROFESOR VARCHAR(25) NOT NULL, 
	NOMBRE VARCHAR(25),
	APELLIDOS VARCHAR(25),
	TELEFONO VARCHAR(25),
	EMAIL VARCHAR(25),
	PADECIMIENTOS VARCHAR(25)
	Direccion	
	IdMateria
);

-------------------------------------------------------------------------------- INSERTS

INSERT INTO TB_Parentesco VALUES ('1','ABUELO')
INSERT INTO TB_Encargados VALUES ('112341234','MARIO','SEGURA','22222222','33333333','44444444','MARIO@.COM','POR AHI','1','','')

SELECT E.NOMBRE, P.NOMBRE 
FROM TB_Parentesco P, TB_Encargados E 
WHERE P.ID_PARENTESCO = E.ID_PARENTESCO  

/*********** TB_ROLES ***********/

INSERT INTO TB_ROLES VALUES (1, 'ADMINISTRADOR')
INSERT INTO TB_ROLES VALUES (2, 'VISITANTE')

/*********** TB_USUARIOS ***********/

INSERT INTO TB_USUARIOS VALUES ('32PvPP54oP0=','32PvPP54oP0=',0,0,0,'0','KEVIN','OLEAGA GARCIA',60767225,1,'OLEAGA@OUTLOOK.COM',116351234,'','','')

-------------------------------------------------------------------------------- SELECTS

/*********** TB_USUARIOS -> TB_ROLES ***********/

SELECT U.NOMBRE + ' ' + U.APELLIDOS AS NOMBRE, R.NOMBRE AS ROL
FROM TB_USUARIOS U, TB_ROLES R
WHERE U.ID_ROL = R.ID_ROL;

SELECT * FROM TB_Roles;
SELECT * FROM TB_Usuarios;



SELECT * FROM TB_ROLES
update TB_USUARIOS set CUENTA_BLOQUEADA = 0 where USUARIO = '32PvPP54oP0=' 

-->